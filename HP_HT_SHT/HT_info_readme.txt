Υλοποίηση Συστημάτων Βάσεων Δεδομένων


Γρηγόρης Ταμπαξής 1115202000188




Σύντομες περιγραφές συναρτήσεων κατακερματισμού:(HT_info)
•	HT_CreateFile: Αρχικά δημιουργώ τα 2 πρώτα μπλοκ τα οποία δεν προορίζονται για εγγραφές. Στον πρώτο μπλοκ βάζω τον δείχτη του ht info ενώ στο δεύτερο υλοποιώ έναν πίνακα ακεραίων στοιχειο πινακα αντιστοιχεί σε έναν κάδο.

•	HT_OpenFile: Ανοίγω το αρχείο, ελέγχω αν πρόκειται για αρχείο κατακερματισμού (heap_or_hash_or_nothing==2) και αν όχι επιστρέφω μήνυμα λάθους.

•	HT_CloseFile:Κλείνω το αρχείο και αν όλα πάνε καλά ελευθερώνω τον δεσμευμένο χώρο αλλιώς επιστρέφω μήνυμα λάθους.

•	HT_InsertEntry: Με την βοήθεια της hash συνάρτησης μου (record.id % ht_info->numBuckets) βρίσκω τον κάδο στον οποίο αντιστοιχεί η νέα εγγραφή μου. Στην συνέχεια ελέγχω το αντίστοιχο κελί του πίνακα που έχω δημιουργήσει. 
o	Αν το block_id του κελιού είναι 0 τότε δημιουργώ το 1ο μπλοκ στον κάδο αυτό και προσθέτω την εγγραφή  μου σε αυτό. Το κάθε μπλοκ χωράει 6 εγγραφές.

o	Αν το block_id είναι διαφορο του 0 τοτε εχει ηδη συνδεθει καποιο block σε αυτον τον καδο.Σε αυτην την περιπτωση ξεκιναμε και ελεγχουμε τις εξης περιπτωσεις.

1)Ειτε το 1ο μπλοκ του καδου εχει υπερχειλησει οπου τοτε μεταφερομαστε στο επομενο καθως εχει ηδη δημιουργηθει επομενο μπλοκ με το οποιο συνδεσαμε το πρωτο και γενικως συνεχιζουμε αυτην την διαδικασια μεχρι ειτε να βρεθει ενα μπλοκ που ειναι γεματο αλλα δεν εχει συνδεθει με επομενο μπλοκ,ειτε θα βρουμε ενα μπλοκ ενα μη γεματο μπλοκ και θα βαλουμε εκει την εγγραφη

2)Ειτε το 1ο μπλοκ δεν εχει γεμισει οπου τοτε απλα προσθετουμε την εγγραφη.

3)Ειτε το 1ο μπλοκ εχει γεμισει αλλα δεν εχει υπερχειλησει (overflowed=0) .Τοτε απλα δημιουργουμε ενα καινουργιο μπλοκ το συνδεουμε με το πρωτο και προσθετουμε σε αυτο την εγγραφη. 


HT_GetAllEntries: Για κάθε μπλοκ ελεγχει αν καποια απο τις 6 εγγραφες(γιατι μεχρι τοσες μπορει να εχει ενα μπλοκ) εχει τιμη id ιση με την τιμη value και αν εχει εκτυπωνει την εγγραφη.

Τελος χρησιμοποιουμε τις structs HT_block_info που περιεχει μεταβλητες που δειχνουν αν ενα μπλοκ εχει υπερχειλησει,τον αριθμο εγγραφων του συγκεκριμενου μπλοκ,τον αριθμο του συγκρεκριμενου μπλοκ και τον αριθμο του μπλοκ με το οποιο εχει συνδεθει στον καδο που βρισκεται(next_block) και HT_info η οποια εχει τεσσερις μεταβλητες.
Μια για να γνωριζουμε αν το αρχειο ειναι κατακερματισμου.
Μια που δειχνει τον συνολικο αριθμο των εγγραφων.
Και μια που ειναι ο αναγνωριστικός αριθμός του ανοίγματος του αρχείου.
Μια που δειχνει τον αριθμο των καδων σε αυτο το αρχειο.
