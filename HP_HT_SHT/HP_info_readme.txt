Υλοποίηση Συστημάτων Βάσεων Δεδομένων


Γρηγόρης Ταμπαξής 1115202000188




Συναρτήσεις σωρού:

HP_CreateFile: Δημιουργεί το αρχείο.Δημιουργουμε ενα δεικτη HP_info Που αρχικοποιεί τις εξής μεταβλητές: 
heap_or_hash_or_nothing = 1 προκειμένου να ξέρεουμε ότι πρόκειται για αρχείο σωρού.
number_of_records = 0 καθώς μιλάμε για το πρώτο μπλοκ στο οποίο δεν έχουν γίνει ακόμα εγγραφές filedisc=fd το αναγνωριστικό του αρχείου.
Στην συνέχεια μεταφερουμε αυτον τον δεικτη στο 1ο μπλοκ.


HP_OpenFile: Ανοίγει το αρχείο αφού πρώτα ελέγξει στο πρώτο μπλοκ αν πρόκειται για αρχείο σωρού. Αν όχι, επιστέφει μήνυμα λάθους.

HP_CloseFile: Κλείνει το αρχείο. Αν όλα πάνε καλά ελευθερώνει τον δεσμευμένο χώρο αλλιώς επιστρέφει μήνυμα λάθους.

HP_InsertEntry: Αρχικά πρέπει να ελέγξουμε αν η νέα εγγραφή μας χωράει στο τελευταίο μπλοκ που δημιουργήσαμε. Αυτό γίνεται συγκρίνοντας το μέγεθος του αρχείου που θέλουμε να εγγράψουμε (sizeof(Record)) με τον χώρο που έχει απομείνει στο μπλοκ μας 
freespace = BF_BLOCK_SIZE - hp_info->number_of_records *(sizeof(Record))
Αν χωράει αντιγράφουμε με την memcpy το αρχείο μας στο μπλοκ και αυξάνουμε τον μετρητή των records
Αν δεν χωράει κάνουμε unpin το προηγούμενο μπλοκ και δημιουργούμε ένα νέο μπλοκ και αντιγράφουμε εκεί την εγγραφή μας με την memcpy. Το κάνουμε dirty και unpin.

HP_GetAllEntries Για κάθε μπλοκ ελεγχει αν καποια απο τις 6 εγγραφες(γιατι μεχρι τοσες μπορει να εχει ενα μπλοκ) εχει τιμη id ιση με την τιμη value και αν εχει εκτυπωνει την εγγραφη.
